<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Team Scores Line Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<h2>Team Score Over Time</h2>
<canvas id="lineChartTotal" width="800" height="400"></canvas>

<h2>Auto Score Over Time</h2>
<canvas id="lineChartAuto" width="800" height="400"></canvas>

<h2>Teleop Score Over Time</h2>
<canvas id="lineChartTeleop" width="800" height="400"></canvas>

<script>
    // ðŸŽ¨ Dynamic color generator for unlimited distinct colors
    function generateColor(index) {
        const hue = (index * 137.508) % 360; // evenly spaced hues
        return `hsl(${hue}, 70%, 55%)`;
    }

    // Use the timestamps from the first team for labels
    const labels = [
        {% if teams and teams | length > 0 %}
            {% for item in teams[0] %}
                "{{ item.created_at }}"{% if not loop.last %},{% endif %}
            {% endfor %}
        {% endif %}
    ];

    // --- Total score datasets ---
    const datasetsTotal = [
        {% for team in teams %}
        {
            label: "Team {{ team_numbers[loop.index0] }} Total",
            data: [
                {% for item in team %}
                    {{ item.total_score }}{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            fill: false,
            borderColor: generateColor({{ loop.index0 }}),
            tension: 0.1
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    // --- Auto score datasets ---
    const datasetsAuto = [
        {% for team in teams %}
        {
            label: "Team {{ team_numbers[loop.index0] }} Auto",
            data: [
                {% for item in team %}
                    {{ item.auto_total }}{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            fill: false,
            borderColor: generateColor({{ loop.index0 }}),
            tension: 0.1
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    // --- Teleop score datasets ---
    const datasetsTeleop = [
        {% for team in teams %}
        {
            label: "Team {{ team_numbers[loop.index0] }} Teleop",
            data: [
                {% for item in team %}
                    {{ item.teleop_total }}{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            fill: false,
            borderColor: generateColor({{ loop.index0 }}),
            tension: 0.1
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    // --- Common chart options ---
    const commonOptions = {
        scales: {
            y: {
                min: 0,
                max: 200,
                title: {
                    display: true,
                    text: 'Score'
                }
            },
            x: {
                title: {
                    display: true,
                    text: 'Match Time'
                }
            }
        },
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    };

    // --- Chart.js configs ---
    new Chart(document.getElementById('lineChartTotal'), {
        type: 'line',
        data: { labels, datasets: datasetsTotal },
        options: commonOptions
    });

    new Chart(document.getElementById('lineChartAuto'), {
        type: 'line',
        data: { labels, datasets: datasetsAuto },
        options: commonOptions
    });

    new Chart(document.getElementById('lineChartTeleop'), {
        type: 'line',
        data: { labels, datasets: datasetsTeleop },
        options: commonOptions
    });
</script>
</body>
</html>

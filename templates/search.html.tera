<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Search Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tablesort.js -->
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>

<style>
body { background-color: #2a2727; color: white; font-family: monospace; text-align: center; margin:0; padding:1rem; }
h1 { margin-bottom: 1rem; }
.table-wrapper { overflow-x:auto; }
table { border-collapse: collapse; width:100%; min-width:800px; margin: 0 auto 2rem auto;}
th, td { border:1px solid #555; padding:0.5rem 0.75rem; text-align:left;}
th { background-color:#3a3737; cursor:pointer; position:relative; user-select:none;}
th.sortable::after { content:"⇅"; position:absolute; right:8px; font-size:0.8em; opacity:0.4;}
th.tablesort-up::after { content:"▲"; opacity:0.8; }
th.tablesort-down::after { content:"▼"; opacity:0.8;}
tr:nth-child(even){background-color:#353131;}
.bool-true {background-color:#4caf50;color:black;font-weight:bold;}
.bool-false {background-color:#f44336;color:black;font-weight:bold;}
.optional { color:#ccc; }
</style>
</head>
<body>

<h1>Search Results</h1>

{% if entries | length == 0 %}
<p>No results found.</p>
{% else %}
<div class="table-wrapper">
<table id="results">
<thead>
<tr>
<th class="sortable numeric">ID</th>
<th class="sortable">Team</th>
<th class="sortable">Scouter</th>
<th class="sortable numeric">Match ID</th>
<th class="sortable numeric">Total Score</th>
<th class="sortable numeric">Game Pieces</th>
<th class="sortable">Event</th>
<th class="sortable numeric">Moved</th>
<th class="sortable numeric">Died</th>
<th class="sortable numeric">Defense Rating</th>
<th class="sortable">Climb Type</th>
<th class="sortable">Created At</th>
<th class="sortable">Comment</th>
</tr>
</thead>
<tbody>
{% for zip in entries %}
{% set t = zip.0 %}
{% set e = zip.1 %}
{% set p = zip.2 %}
<tr>
<td data-sort="{{ e.id }}">{{ e.id }}</td>
<td>
<a href="/viewpit/{{ e.event_code }}/{{ e.team }}">{{ e.team }}</a>
</td>
<td>{{ e.user | default(value="—") }}</td>
<td data-sort="{{ e.matchid }}">{{ e.matchid }}</td>
<td data-sort="{{ e.total_score }}">{{ e.total_score }}</td>
<td data-sort="{{ p }}">{{ p }}</td>
<td>{{ e.event_code }}</td>
<td class="{% if e.moved %}bool-true{% else %}bool-false{% endif %}" data-sort="{% if e.moved %}1{% else %}0{% endif %}">{% if e.moved %}✔{% else %}✖{% endif %}</td>
<td class="{% if e.died %}bool-true{% else %}bool-false{% endif %}" data-sort="{% if e.died %}1{% else %}0{% endif %}">{% if e.died %}✔{% else %}✖{% endif %}</td>
<td data-sort="{{ e.defense_rating | default(value='0') }}">{{ e.defense_rating | default(value="—") }}</td>
<td>{{ e.climb_type | default(value="—") }}</td>
<td>{{ e.created_at_fmt | default(value="—") }}</td>
<td class="optional">{{ e.comment | default(value="") }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
{% endif %}

<script>
// Add a numeric parser so Tablesort sorts numeric columns correctly
Tablesort.extend('numeric', function(item) {
    return !isNaN(parseFloat(item.replace(/[^0-9.\-]/g, '')));
}, function(a, b) {
    return parseFloat(a.replace(/[^0-9.\-]/g, '')) - parseFloat(b.replace(/[^0-9.\-]/g, ''));
});

// Initialize Tablesort
new Tablesort(document.getElementById('results'));
</script>

</body>
</html>
